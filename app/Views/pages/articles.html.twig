{% extends "base.html.twig" %}

{% block content %}

	<div class="all-articles">
		

		<h1 class="articles-title-selection"> Market Place</h1>

		<div class="articles-cards">
		{% set index=0 %}
			{% for article in articles %}
				<div class="article-card {{article.getStock()<=0? 'article-card-out-of-stock' : ''}}" data-number={{index}} {{ index > 7 ? 'hidden' : ''}}>
					<div class="article-img" style='background-image: url("https://jolivet.needemand.com/realisations/nesti-admin/public/pictures/pictures/{{article.getPicture().name~"."~article.getPicture().extension }}");'></a>
				</div>
				<div class="article-card-body">
					<h5 class="article-card-title">{{article.quantity_per_unit~" "~article.getUnitMeasure().name~" of "~article.getIngredient().product_name}}</h5>
					<div class="article-card-price">{{article.getLastPrice() | round(2, 'ceil')}} â‚¬</div>
					{% if article.getStock()<=0 %}
					<div class="article-out-of-stock">Out of stock</div>
					{% endif %}
					<a href="{{ base_url('/article/'~article.id_article) }}">
						<button class="article-btn-see">See Article</button>
					</a>
				</div>
			</div>
			{% set index=index+1 %}
		{% endfor %}
	</div>
	{% set numberPage=(articles | length /8) | round(0,'ceil') %}

	<div class="btn-pagination-articles">
		{% if numberPage>1 %}
			<button id="btn_prev" class="btn-pagination" onclick="prevPage()">Prev</button>

			{% for index in 1..numberPage %}
				<button id="btn_page" class="btn-pagination" onclick="goPage({{index}})">{{index}}</button>

			{% endfor %}
			<button id="btn_next" class="btn-pagination" onclick="nextPage()">Next</button>
		{% endif %}
	</div>
</div>{% endblock %}{% block script %}
<script>

var current_page = 1;
var card_per_page = 8;
var numPage = {{ (articles | length /8) | round(0,'ceil') }};

var recipeCards = document.querySelectorAll(".article-card");

function goPage(pageNumber) {
current_page = pageNumber;
changePage(pageNumber);
}


function prevPage() {
if (current_page > 1) {
current_page--;
changePage(current_page);
}
}

function nextPage() {
if (current_page < numPages()) {
current_page++;
changePage(current_page);
}
}

function changePage(page) {
var btn_next = document.getElementById("btn_next");
var btn_prev = document.getElementById("btn_prev");
var page_span = document.getElementById("page");

// Validate page
if (page < 1) {
page = 1;
}

if (page > numPages()) {
page = numPages();
}

recipeCards.forEach(function (element) {

if (element.getAttribute("data-number") >= ((page - 1) * card_per_page) && element.getAttribute("data-number") <= ((page * card_per_page) - 1)) {
element.hidden = false;
} else {
element.hidden = true;
}

scroll(0, 0)

})
}

function numPages() {
return numPage;
}

</script>{% endblock %}
